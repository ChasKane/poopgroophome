<!DOCTYPE html>
<html>

	<head>
		<title>Contacts</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		
	</head>
	
	<h1 class="text-center">LogIn or SignIn</h1>
	
	<h2>This is a login for testing the contactTable. (contacts are recieved from DB)</h2>

	<p id="demo"></p>
	<div>
		<button type="button" id="loginButton" class="buttons" onclick="signUp();"> SignUp </button>
	</div>
	<div>
		<button type="button" id="loginButton" class="buttons" onclick="login();"> Login </button>
	</div>

	
	
	<body id="contactTableBod" style="background-color:rgb(255, 255, 255);">
	
		
		<div id="contactTableDiv" style="visibility:hidden;">
			<h2 class="text-center">Contact List</h2>
			
			<div>
			<button type="button" id="loginButton" class="buttons" onclick="fillContactTable();"> Update Table </button>
		</div>

			
			<div class="container">
				<div class="table-responsive">
					<table class="table table-striped table-bordered table-condensed table-hover">
						
						<thead>
							<tr>
								<th>FirstName</th>
								<th>LastName</th>
								<th>Options</th>
							</tr>
						</thead>
						<tbody id="tableBod">
							
						</tbody>
						
						
					</table>
				</div>
				
			</div>
		</div>
		<!-- Here is the pop ups -->
		
		<div class="modal fade" id="contactView" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h2 class="modal-title">Contact Name</h2>
					</div>
					<div class="modal-body">
						<p>contact info</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="contactEdit" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h2 class="modal-title">Contact Name</h2>
					</div>
					<div class="modal-body">
						<p>Edit info</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close</button>
					</div>
				</div>
			</div>
		</div>
		
		<div class="modal fade" id="contactDelete" role="dialog">
			<div class="modal-dialog">
				<div class="modal-content">
					<div class="modal-header">
						<button type="button" class="close" data-dismiss="modal">&times;</button>
						<h2 class="modal-title">Delete Contact</h2>
					</div>
					<div class="modal-body">
						<p>Are you sure you want to delet this contact?</p>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal">close</button>
					</div>
				</div>
			</div>
		</div>
		
		
	</body>

	<body>

	
	<script>
		var sessId, baseUrl = "http://46.101.111.146", objRequest, dbReqParam, xmlHRequest, tObjs, x, htmlTxt = "";
		

		function signUp()
		{
			var url = baseUrl + '/signup';
			dbReqParam = '{"first_name" : "Anonie3", "last_name" : "Derpie3", "username" : "Mortyie3", "password" : "password"}';
			
			xmlHRequest = new XMLHttpRequest();
			xmlHRequest.open("POST", url, false);
			xmlHRequest.setRequestHeader("Content-type", "application/json; charset=UTF-8");
			try
			{
				
				xmlHRequest.send(dbReqParam);
				
				var jsonRec = JSON.parse(xmlHRequest.responseText);
				
				sessId = jsonRec.session_id;
				
				document.getElementById("demo").innerHTML += "<div>Object recieved:" + jsonRec + " SessionID: " + sessId + "</div>";
			}
			catch(err)
			{
				document.getElementById("demo").innerHTML += "<div>" + err.message + " " + jsonRec + " " + sessId + "</div>";
			}
		}
			
		function login()
		{
			var url = baseUrl + '/login';
			dbReqParam = '{"username" : "suraj", "password" : "password"}';
			
			xmlHRequest = new XMLHttpRequest();
			xmlHRequest.open("POST", url, false);
			xmlHRequest.setRequestHeader("Content-type", "application/json; charset=UTF-8");
			try
			{
				xmlHRequest.send(dbReqParam);
				
				var jsonRec = JSON.parse(xmlHRequest.responseText);
				
				sessId = jsonRec.session_id;
				
				if (sessId < 1)
				{
					document.getElementById("demo").innerHTML += "<div>SessionID: " + sessId + " ERR: User/Pass incorrect"+ "</div>";
					return;
				}
				
				document.getElementById("contactTableDiv").style.visibility = "visible";
				
				fillContactTable();
				
				document.getElementById("demo").innerHTML += "<div>Object recieved: " + jsonRec + " SessionID: " + sessId + "</div>";
			}
			catch(err)
			{
				document.getElementById("demo").innerHTML += "<div>" + err.message + " " + jsonRec + " " + sessId + "</div>";
			}
			
		}
		
		function fillContactTable() 
		{
			var i, j, url = baseUrl + '/profile';
			dbReqParam = '{"session_id" : "' + sessId + '"}';
			
			xmlHRequest = new XMLHttpRequest();
			xmlHRequest.open("POST", url, false);
			xmlHRequest.setRequestHeader("Content-type", "application/json; charset=UTF-8");
			try
			{
				xmlHRequest.send(dbReqParam);
				
				var jsonRec = JSON.parse(xmlHRequest.responseText);
				
				if (sessId < 1)
				{
					document.getElementById("demo").innerHTML += "<div>SessionID: " + sessId + " ERR: User/Pass incorrect"+ "</div>";
					return;
				}
				
				document.getElementById("contactTableDiv").style.visibility = "visible";
				document.getElementById("tableBod").innerHTML = "<div></div>";
				
				document.getElementById("demo").innerHTML += "<div>" + " SessionID: " + sessId + "</div>";
				
				for (i = 0; i < jsonRec.contact_list.length; i++)
				{
					document.getElementById("tableBod").innerHTML += "<tr>";
					
					document.getElementById("tableBod").innerHTML += "<td>" + jsonRec.contact_list[i][2] + "</td>" + "<td>" + jsonRec.contact_list[i][3] + "</td>"
					+'<td> <div class="btn-group">' +
										 '<button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#contactView"><span class="glyphicon glyphicon-info-sign"></span> View</button>' +
										'<button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#contactEdit"><span class="glyphicon glyphicon-pencil"></span> Edit</button>' +
										'<button type="button" class="btn btn-primary btn-xs" data-toggle="modal" data-target="#contactDelete"><span class="glyphicon glyphicon-trash"></span> Delete</button>' +
									'</div></td>';
					
					//for (j = 0; j < jsonRec.contact_list[i].length; j++)
					//{
						//document.getElementById("tableBod").innerHTML += "<td>" + jsonRec.contact_list[i][2] + "</td>" + 
						//"<td>" + jsonRec.contact_list[i][3] + "</td>";
					//}
					
					document.getElementById("tableBod").innerHTML += "</tr>";
				}
				
				console.log(jsonRec);
				
				//document.getElementById("demo").innerHTML += "<div> out loop" + jsonRec.contact_list.length + jsonRec.contact_list[0][3] +" </div>";
			}
			catch(err)
			{
				document.getElementById("demo").innerHTML += "<div>" + err.message + " " + jsonRec + " " + sessId + "</div>";
			}
		}
		
		
	</script>

	</body>
	
	<!-- get styls and stuff from bootstrap-->
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
		
	
</html>
